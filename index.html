<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>MoodDiary - ê°ì • ì¼ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
    (function() {
      // í˜„ì¬ í˜ì´ì§€ê°€ ìºì‹œëœ ë²„ì „ì¸ì§€ í™•ì¸
      if (performance.navigation.type !== 1) {
        // í˜ì´ì§€ê°€ ìƒˆë¡œ ë¡œë“œëœ ê²ƒì´ ì•„ë‹ˆë¼ë©´ ê°•ì œ ìƒˆë¡œê³ ì¹¨
        setTimeout(function() {
          alert('ìµœì‹  ë²„ì „ì„ ë¡œë“œí•˜ê¸° ìœ„í•´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
          window.location.reload(true);
        }, 500);
      } else {
        // ìƒˆë¡œê³ ì¹¨ë˜ì—ˆì„ ë•Œ ì•Œë¦¼ í‘œì‹œ
        setTimeout(function() {
          alert('í˜ì´ì§€ê°€ ìµœì‹  ë²„ì „ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì œ ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.');
        }, 1000);
      }
    })();
    
    // ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì¦‰ì‹œ ì‹¤í–‰ë˜ëŠ” ë””ë²„ê·¸ ë©”ì‹œì§€
    console.log('%cìŠ¤í¬ë¦½íŠ¸ ì´ˆê¸°í™”! í˜„ì¬ ì‹œê°„: ' + new Date().toISOString(), 'background: #f00; color: #fff; font-size: 20px; padding: 10px;');
    console.log('%cì´ ë©”ì‹œì§€ê°€ ë³´ì´ë©´ ìŠ¤í¬ë¦½íŠ¸ê°€ ì œëŒ€ë¡œ ë¡œë“œë¨', 'background: #f00; color: #fff; font-size: 16px;');
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            "emotion-happy": "#FFD700",
            "emotion-sad": "#6495ED",
            "emotion-angry": "#FF4500",
            "emotion-anxious": "#808080",
            "emotion-neutral": "#98FB98"
          }
        }
      }
    }
  </script>
  <style>
    .modal {
      display: none;
      position: fixed;
      z-index: 50;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.4);
    }
    .modal-open {
      display: block;
    }
  </style>
</head>
<body class="bg-gray-100">
  <!-- ì—…ë°ì´íŠ¸ ì•Œë¦¼ ë°°ë„ˆ -->
  <div id="updateNotice" class="w-full bg-blue-600 text-white p-4 text-center font-bold sticky top-0 z-50">
    í˜ì´ì§€ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤ (ë²„ì „: <span id="pageVersion">ë¡œë”© ì¤‘...</span>)
    <button onclick="this.parentNode.remove()" class="ml-4 bg-white text-blue-600 px-2 py-1 rounded-md">ë‹«ê¸°</button>
  </div>
  <script>
    // ë²„ì „ ì •ë³´ ì—…ë°ì´íŠ¸
    document.getElementById('pageVersion').textContent = new Date().toLocaleString('ko-KR');
  </script>
  
  <main class="flex min-h-screen flex-col items-center justify-center p-4 bg-gradient-to-b from-white to-gray-100">
    <div class="container mx-auto max-w-5xl bg-white shadow-lg rounded-lg p-8">
      <div class="text-center">
        <h1 class="text-4xl font-bold mb-2 text-gray-800">MoodDiary</h1>
        <p class="text-xl text-gray-600 mb-8">ë‹¹ì‹ ì˜ ê°ì •ì„ ê¸°ë¡í•´ë³´ì„¸ìš”</p>
        
        <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 mt-8">
          <div class="bg-emotion-happy bg-opacity-20 p-6 rounded-lg">
            <h2 class="text-xl font-semibold mb-2">ì¼ê¸° ì‘ì„±</h2>
            <p class="text-gray-700 mb-4">ë§¤ì¼ì˜ ê°ì •ê³¼ ìƒê°ì„ ê¸°ë¡í•˜ì„¸ìš”</p>
            <button id="openWriteModal" name="openWriteModal" class="inline-block bg-emotion-happy text-white px-4 py-2 rounded-md font-medium" aria-label="ì¼ê¸° ì‘ì„± ì‹œì‘í•˜ê¸°">
              ì‹œì‘í•˜ê¸°
            </button>
          </div>
          
          <div class="bg-emotion-sad bg-opacity-20 p-6 rounded-lg">
            <h2 class="text-xl font-semibold mb-2">ê°ì • ë¶„ì„</h2>
            <p class="text-gray-700 mb-4">AIê°€ ë‹¹ì‹ ì˜ ê°ì •ì„ ë¶„ì„í•©ë‹ˆë‹¤11111</p>
            <button id="viewDiaryBtn" name="viewDiaryBtn" class="inline-block bg-emotion-sad text-white px-4 py-2 rounded-md font-medium" aria-label="ì¼ê¸° ëª©ë¡ ë³´ê¸°">
              ì¼ê¸° ë³´ê¸°
            </button>
          </div>
          
          <div class="bg-emotion-neutral bg-opacity-20 p-6 rounded-lg">
            <h2 class="text-xl font-semibold mb-2">ê°ì • ì‹œê°í™”</h2>
            <p class="text-gray-700 mb-4">ìƒ‰ìƒê³¼ ì•„ì´ì½˜ìœ¼ë¡œ ê°ì •ì„ í‘œí˜„í•©ë‹ˆë‹¤</p>
            <button id="statsBtn" name="statsBtn" class="inline-block bg-emotion-neutral text-gray-800 px-4 py-2 rounded-md font-medium" aria-label="ê°ì • í†µê³„ ë³´ê¸°">
              í†µê³„ ë³´ê¸°
            </button>
          </div>
        </div>

        <!-- ì¼ê¸° ëª©ë¡ -->
        <div id="diaryList" class="mt-8 text-left hidden">
          <h2 class="text-2xl font-bold mb-4">ë‚´ ì¼ê¸° ëª©ë¡</h2>
          <div id="diaryItems" class="space-y-4">
            <!-- ì—¬ê¸°ì— ì¼ê¸° í•­ëª©ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
          </div>
        </div>

        <div class="mt-12 text-center">
          <p class="text-gray-500">Note: ì´ í˜ì´ì§€ëŠ” ì„ì‹œ ë¯¸ë¦¬ë³´ê¸°ì…ë‹ˆë‹¤. ì‹¤ì œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ Node.jsë¥¼ ì„¤ì¹˜í•˜ê³  npm run devë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.</p>
        </div>
        
        <!-- ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ìƒíƒœ í™•ì¸ ì„¹ì…˜ -->
        <div class="mt-8 p-4 bg-gray-100 rounded-lg">
          <h3 class="text-lg font-bold mb-2">ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ìƒíƒœ</h3>
          <div id="storageStatus" class="text-left">
            <p>ìƒíƒœ: <span id="storageAvailable" class="font-bold">í™•ì¸ ì¤‘...</span></p>
            <p>í…ŒìŠ¤íŠ¸ ê²°ê³¼: <span id="storageTestResult" class="font-bold">ë¯¸ì‹¤í–‰</span></p>
            <p>ì €ì¥ëœ ì¼ê¸° ìˆ˜: <span id="storageDiaryCount" class="font-bold">í™•ì¸ ì¤‘...</span></p>
            <div class="mt-2">
              <button 
                id="checkStorageBtn" 
                class="bg-blue-500 text-white px-2 py-1 rounded-md text-sm"
              >
                ìƒíƒœ í™•ì¸
              </button>
              <button 
                id="clearStorageBtn" 
                class="bg-red-500 text-white px-2 py-1 rounded-md text-sm ml-2"
              >
                ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™”
              </button>
              <button 
                id="forceRefreshBtn" 
                class="bg-purple-500 text-white px-2 py-1 rounded-md text-sm ml-2"
              >
                ê°•ì œ ìƒˆë¡œê³ ì¹¨
              </button>
              <button 
                id="resetAndTestBtn" 
                class="bg-green-600 text-white px-2 py-1 rounded-md text-sm ml-2"
              >
                ì™„ì „ ë¦¬ì…‹+í…ŒìŠ¤íŠ¸
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- ì¼ê¸° ì‘ì„± ëª¨ë‹¬ -->
  <div id="writeModal" class="modal">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
        <h2 class="text-2xl font-bold mb-4">ìƒˆ ì¼ê¸° ì‘ì„±</h2>
        
        <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ì¶”ê°€ -->
        <div class="mb-4 flex justify-center">
          <button 
            type="button" 
            id="testLocalStorageBtn"
            class="bg-purple-500 text-white px-4 py-2 rounded-md text-sm"
          >
            ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸
          </button>
        </div>
        
        <form id="diaryForm" name="diaryForm">
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2" for="diaryDate">ë‚ ì§œ</label>
            <div class="relative">
              <input 
                type="text" 
                id="diaryDate" 
                name="diaryDate"
                class="w-full border border-gray-300 rounded-lg pl-4 pr-10 py-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"
                placeholder="ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”"
                required
              >
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" class="w-5 h-5 text-gray-400">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                </svg>
              </div>
            </div>
          </div>
          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1" for="diaryContent">ë‚´ìš©</label>
            <textarea 
              id="diaryContent" 
              name="diaryContent"
              class="w-full border border-gray-300 rounded-md px-3 py-2 h-40"
              placeholder="ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë– ì…¨ë‚˜ìš”? ê°ì •, ìƒê° ë“±ì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”."
              required
            ></textarea>
          </div>
          <div class="flex justify-end space-x-3">
            <button 
              type="button" 
              id="closeModal"
              name="closeModal"
              class="bg-gray-200 text-gray-700 px-4 py-2 rounded-md"
              aria-label="ì·¨ì†Œ"
            >
              ì·¨ì†Œ
            </button>
            <button 
              type="submit" 
              id="saveButton"
              name="saveButton"
              class="bg-blue-500 text-white px-4 py-2 rounded-md"
              aria-label="ì €ì¥"
            >
              ì €ì¥
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
    function isLocalStorageAvailable() {
      console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ ì¤‘...');
      try {
        const test = '__test__' + new Date().getTime();
        console.log(`í…ŒìŠ¤íŠ¸ í‚¤: "${test}" ì €ì¥ ì‹œë„`);
        localStorage.setItem(test, test);
        const result = localStorage.getItem(test) === test;
        console.log(`í…ŒìŠ¤íŠ¸ í‚¤ í™•ì¸ ê²°ê³¼: ${result ? 'ì¼ì¹˜' : 'ë¶ˆì¼ì¹˜'}`);
        localStorage.removeItem(test);
        console.log('í…ŒìŠ¤íŠ¸ í‚¤ ì‚­ì œ ì™„ë£Œ');
        console.log(`ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš© ê°€ëŠ¥: ${result}`);
        return result;
      } catch (e) {
        console.error('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', e);
        return false;
      }
    }
    
    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í‚¤
    const STORAGE_KEY = 'mood-diary-entries';
    
    function getAllDiaries() {
      console.log('%c=== getAllDiaries í•¨ìˆ˜ ì‹œì‘ ===', 'background: #0a0; color: #fff; font-weight: bold; padding: 2px 5px;');
      
      // ë©”ëª¨ë¦¬ ë°ì´í„° í™•ì¸ (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ìš°íšŒìš©)
      if (window.diaryEntries && window.diaryEntries.length > 0) {
        console.log(`ë©”ëª¨ë¦¬ì—ì„œ ë°ì´í„° ë¡œë“œ: ${window.diaryEntries.length}ê°œ í•­ëª©`);
        console.log('%c=== getAllDiaries í•¨ìˆ˜ ì™„ë£Œ (ë©”ëª¨ë¦¬) ===', 'background: #0a0; color: #fff; font-weight: bold; padding: 2px 5px;');
        return window.diaryEntries;
      }
      
      // ê·¸ í›„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í™•ì¸
      console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í™•ì¸ ì‹œë„');
      if (!isLocalStorageAvailable()) {
        console.warn('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë©”ëª¨ë¦¬ ëª¨ë“œë¡œ ì „í™˜í•©ë‹ˆë‹¤.');
        window.diaryEntries = window.diaryEntries || [];
        console.log(`ë¹ˆ ë©”ëª¨ë¦¬ ë°°ì—´ ë°˜í™˜: ${window.diaryEntries.length}ê°œ í•­ëª©`);
        console.log('%c=== getAllDiaries í•¨ìˆ˜ ì™„ë£Œ (ë¹ˆ ë©”ëª¨ë¦¬) ===', 'background: #0a0; color: #fff; font-weight: bold; padding: 2px 5px;');
        return window.diaryEntries;
      }
      
      try {
        console.log(`ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í‚¤ '${STORAGE_KEY}' ì½ê¸° ì‹œë„`);
        const data = localStorage.getItem(STORAGE_KEY);
        console.log(`ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€: ${data ? 'ìˆìŒ' : 'ì—†ìŒ'}`);
        
        if (!data) {
          console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„°ê°€ ì—†ìŒ, ë¹ˆ ë°°ì—´ ë°˜í™˜');
          window.diaryEntries = [];
          console.log('%c=== getAllDiaries í•¨ìˆ˜ ì™„ë£Œ (ë¹ˆ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€) ===', 'background: #0a0; color: #fff; font-weight: bold; padding: 2px 5px;');
          return [];
        }
        
        console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„° íŒŒì‹± ì‹œë„');
        const parsed = JSON.parse(data);
        console.log(`íŒŒì‹± ì„±ê³µ: ${parsed.length}ê°œ í•­ëª©`);
        
        window.diaryEntries = parsed; // ë©”ëª¨ë¦¬ì—ë„ ë³µì‚¬
        console.log('ë©”ëª¨ë¦¬ì— ë°ì´í„° ë³µì‚¬ ì™„ë£Œ');
        
        console.log('%c=== getAllDiaries í•¨ìˆ˜ ì™„ë£Œ (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€) ===', 'background: #0a0; color: #fff; font-weight: bold; padding: 2px 5px;');
        return parsed;
      } catch (e) {
        console.error('ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', e);
        window.diaryEntries = window.diaryEntries || [];
        console.log(`ì˜¤ë¥˜ë¡œ ì¸í•œ ë¹ˆ ë©”ëª¨ë¦¬ ë°°ì—´ ë°˜í™˜: ${window.diaryEntries.length}ê°œ í•­ëª©`);
        console.log('%c=== getAllDiaries í•¨ìˆ˜ ì™„ë£Œ (ì˜¤ë¥˜) ===', 'background: #0a0; color: #fff; font-weight: bold; padding: 2px 5px;');
        return window.diaryEntries;
      }
    }
    
    function saveDiary(diary) {
      console.log('%c=== saveDiary í•¨ìˆ˜ ì‹œì‘ ===', 'background: #f0f; color: #fff; font-weight: bold; padding: 2px 5px;');
      console.log('ì €ì¥ ìš”ì²­ëœ ì¼ê¸°:', diary);
      
      if (!diary || !diary.id || !diary.content) {
        console.error('ìœ íš¨í•˜ì§€ ì•Šì€ ì¼ê¸° ë°ì´í„°:', diary);
        return false;
      }
      
      // ë©”ëª¨ë¦¬ ì €ì¥ - ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‹¤íŒ¨í•´ë„ ì ìš©
      console.log('ë©”ëª¨ë¦¬ ì €ì¥ ì‹œì‘');
      window.diaryEntries = window.diaryEntries || [];
      const memoryIndex = window.diaryEntries.findIndex(entry => entry.id === diary.id);
      
      if (memoryIndex >= 0) {
        console.log(`ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸ (ì¸ë±ìŠ¤: ${memoryIndex})`);
        window.diaryEntries[memoryIndex] = diary;
      } else {
        console.log('ìƒˆ í•­ëª© ì¶”ê°€');
        window.diaryEntries.push(diary);
      }
      console.log('í˜„ì¬ ë©”ëª¨ë¦¬ í•­ëª© ìˆ˜:', window.diaryEntries.length);
      
      // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‹œë„
      console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì‹œë„');
      const storageAvailable = isLocalStorageAvailable();
      console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€:', storageAvailable);
      
      if (!storageAvailable) {
        console.warn('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.');
        return true; // ë©”ëª¨ë¦¬ì—ëŠ” ì €ì¥ ì„±ê³µ
      }
      
      try {
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìµœì‹  ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹œë„
        console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê¸°ì¡´ ë°ì´í„° ë¡œë“œ ì‹œë„');
        let existing = [];
        const existingData = localStorage.getItem(STORAGE_KEY);
        console.log('ê¸°ì¡´ ë°ì´í„° ë¬¸ìì—´:', existingData);
        
        if (existingData) {
          try {
            existing = JSON.parse(existingData);
            console.log('íŒŒì‹±ëœ ê¸°ì¡´ ë°ì´í„° í•­ëª© ìˆ˜:', existing.length);
            console.log('íŒŒì‹±ëœ ê¸°ì¡´ ë°ì´í„° ìƒ˜í”Œ:', existing.slice(0, 1));
          } catch (parseError) {
            console.warn('ê¸°ì¡´ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜, ì´ˆê¸°í™”í•©ë‹ˆë‹¤:', parseError);
            existing = [];
          }
        } else {
          console.log('ê¸°ì¡´ ë°ì´í„° ì—†ìŒ, ìƒˆ ë°°ì—´ ìƒì„±');
        }
        
        const existingIndex = existing.findIndex(entry => entry.id === diary.id);
        console.log('ê¸°ì¡´ ë°ì´í„° ë‚´ ë™ì¼ ID ê²€ìƒ‰ ê²°ê³¼:', existingIndex);
        
        if (existingIndex >= 0) {
          console.log(`ê¸°ì¡´ í•­ëª© ì—…ë°ì´íŠ¸ (ì¸ë±ìŠ¤: ${existingIndex})`);
          existing[existingIndex] = diary;
        } else {
          console.log('ìƒˆ í•­ëª© ì¶”ê°€');
          existing.push(diary);
        }
        console.log('ì €ì¥í•  ë°ì´í„° í•­ëª© ìˆ˜:', existing.length);
        
        const saveData = JSON.stringify(existing);
        console.log('ì €ì¥í•  JSON ë¬¸ìì—´ ê¸¸ì´:', saveData.length);
        
        // ì‹¤ì œ ì €ì¥ ì‹œë„
        console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ ì‹œë„');
        localStorage.setItem(STORAGE_KEY, saveData);
        console.log('ì €ì¥ ëª…ë ¹ ì‹¤í–‰ ì™„ë£Œ');
        
        // ì €ì¥ í™•ì¸
        const verify = localStorage.getItem(STORAGE_KEY);
        const verifyLength = verify ? verify.length : 0;
        console.log(`ì €ì¥ í™•ì¸ (ë¬¸ìì—´ ê¸¸ì´: ${verifyLength})`);
        
        const verifySuccess = verify === saveData;
        console.log('ì €ì¥ ì¼ì¹˜ ì—¬ë¶€:', verifySuccess);
        
        console.log('%c=== saveDiary í•¨ìˆ˜ ì™„ë£Œ ===', 'background: #f0f; color: #fff; font-weight: bold; padding: 2px 5px;');
        return true;
      } catch (error) {
        console.error('%cì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', 'background: #f00; color: #fff; font-weight: bold; padding: 2px 5px;', error);
        alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        return true; // ë©”ëª¨ë¦¬ì—ëŠ” ì €ì¥ë˜ì—ˆìœ¼ë¯€ë¡œ true ë°˜í™˜
      }
    }
    
    function deleteDiary(id) {
      if (!id) {
        console.error('ì‚­ì œí•  IDê°€ ì—†ìŠµë‹ˆë‹¤');
        return false;
      }
      
      console.log('ì¼ê¸° ì‚­ì œ:', id);
      
      // ë©”ëª¨ë¦¬ ë°ì´í„°ì—ì„œ ì‚­ì œ
      if (window.diaryEntries && window.diaryEntries.length > 0) {
        window.diaryEntries = window.diaryEntries.filter(diary => diary.id !== id);
      }
      
      // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚­ì œ ì‹œë„
      try {
        if (isLocalStorageAvailable()) {
          const diaries = getAllDiaries();
          const filteredDiaries = diaries.filter(diary => diary.id !== id);
          localStorage.setItem(STORAGE_KEY, JSON.stringify(filteredDiaries));
        }
        return true;
      } catch (error) {
        console.error('ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', error);
        return true; // ë©”ëª¨ë¦¬ì—ì„œëŠ” ì‚­ì œë¨
      }
    }
    
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substring(2);
    }

    // ê°„ë‹¨í•œ ê°ì • ë¶„ì„ (í‚¤ì›Œë“œ ê¸°ë°˜)
    function analyzeEmotion(text) {
      const keywords = {
        happy: ['í–‰ë³µ', 'ê¸°ì¨', 'ì¢‹ì€', 'ì¦ê±°ìš´', 'ì‹ ë‚˜ëŠ”', 'ì›ƒìŒ', 'ì¬ë¯¸'],
        sad: ['ìŠ¬í””', 'ìš°ìš¸', 'ì†ìƒ', 'ëˆˆë¬¼', 'ì•„ì‰¬ì›€', 'ê·¸ë¦¬ì›€', 'ì™¸ë¡œì›€'],
        angry: ['í™”ë‚¨', 'ë¶„ë…¸', 'ì§œì¦', 'ì—´ë°›ëŠ”', 'í™”ê°€', 'ë¯¸ì›€', 'ì¦ì˜¤'],
        anxious: ['ë¶ˆì•ˆ', 'ê±±ì •', 'ì´ˆì¡°', 'ìŠ¤íŠ¸ë ˆìŠ¤', 'ë‘ë ¤ì›€', 'ë¬´ì„œì›€'],
        neutral: ['í‰ë²”', 'ë¬´ë‚œ', 'ê·¸ëƒ¥', 'ë³´í†µ', 'ì¼ìƒ', 'ë³„ì¼ ì—†']
      };
      
      const scores = {
        happy: 0,
        sad: 0,
        angry: 0,
        anxious: 0,
        neutral: 1 // ê¸°ë³¸ê°’ìœ¼ë¡œ ì¤‘ë¦½ì— ì•½ê°„ì˜ ê°€ì¤‘ì¹˜
      };
      
      for (const [emotion, words] of Object.entries(keywords)) {
        for (const word of words) {
          if (text.includes(word)) {
            scores[emotion] += 1;
          }
        }
      }
      
      let maxEmotion = 'neutral';
      let maxScore = 0;
      
      for (const [emotion, score] of Object.entries(scores)) {
        if (score > maxScore) {
          maxScore = score;
          maxEmotion = emotion;
        }
      }
      
      return maxEmotion;
    }

    // ì´ëª¨ì§€ ë§µí•‘
    const emotionIcons = {
      happy: 'ğŸ˜Š',
      sad: 'ğŸ˜¢',
      angry: 'ğŸ˜¡',
      anxious: 'ğŸ˜°',
      neutral: 'ğŸ˜',
    };
    
    // ëª¨ë‹¬ ì œì–´
    const writeModal = document.getElementById('writeModal');
    const openWriteModalBtn = document.getElementById('openWriteModal');
    const closeModalBtn = document.getElementById('closeModal');
    const diaryForm = document.getElementById('diaryForm');
    const viewDiaryBtn = document.getElementById('viewDiaryBtn');
    const diaryList = document.getElementById('diaryList');
    const diaryItems = document.getElementById('diaryItems');
    
    // í˜„ì¬ ë‚ ì§œ ì„¤ì •
    document.getElementById('diaryDate').valueAsDate = new Date();
    
    // ëª¨ë‹¬ ì—´ê¸°
    openWriteModalBtn.addEventListener('click', () => {
      writeModal.classList.add('modal-open');
    });
    
    // ëª¨ë‹¬ ë‹«ê¸°
    closeModalBtn.addEventListener('click', () => {
      writeModal.classList.remove('modal-open');
    });
    
    // ì™¸ë¶€ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
    writeModal.addEventListener('click', (e) => {
      if (e.target === writeModal) {
        writeModal.classList.remove('modal-open');
      }
    });
    
    // ì¼ê¸° ì €ì¥
    diaryForm.addEventListener('submit', function(e) {
      // ê¸°ë³¸ ë™ì‘ ë°©ì§€ (í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë°©ì§€)
      e.preventDefault();
      console.log('%cì¼ê¸° ì €ì¥ ì‹œì‘', 'background: #ff0; color: #000; font-weight: bold; padding: 2px 5px;');
      
      // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
      const dateInput = document.getElementById('diaryDate');
      const contentInput = document.getElementById('diaryContent');
      
      console.log('í¼ ìš”ì†Œ í™•ì¸:', {
        í¼_ìì²´: diaryForm, 
        ë‚ ì§œ_ì…ë ¥: dateInput, 
        ë‚´ìš©_ì…ë ¥: contentInput
      });
      
      if (!dateInput || !contentInput) {
        console.error('í¼ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', { dateInput, contentInput });
        return;
      }
      
      const date = dateInput.value;
      const content = contentInput.value;
      
      console.log('%cì…ë ¥ê°’ í™•ì¸', 'background: #0f0; color: #000; font-weight: bold; padding: 2px 5px;');
      console.log('ë‚ ì§œ:', date);
      console.log('ë‚´ìš©:', content);
      console.table({ë‚ ì§œ: date, ë‚´ìš©: content, ë‚ ì§œíƒ€ì…: typeof date, ë‚´ìš©íƒ€ì…: typeof content});
      
      if (!date || !content) {
        console.error('ì…ë ¥ê°’ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤:', { date, content });
        alert('ë‚ ì§œì™€ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      // ê°ì • ë¶„ì„
      const emotion = analyzeEmotion(content);
      console.log('ë¶„ì„ëœ ê°ì •:', emotion);
      
      // ìƒˆ ì¼ê¸° ê°ì²´ ìƒì„±
      const newDiary = {
        id: generateId(),
        date: date,
        content: content,
        emotion: emotion,
        createdAt: new Date().toISOString()
      };
      
      console.log('%cì €ì¥í•  ê°ì²´', 'background: #0ff; color: #000; font-weight: bold; padding: 2px 5px;');
      console.table(newDiary);
      
      try {
        // ë©”ëª¨ë¦¬ì— ì €ì¥
        console.log('ë©”ëª¨ë¦¬ì— ì €ì¥ ì‹œì‘');
        window.diaryEntries = window.diaryEntries || [];
        const oldLength = window.diaryEntries.length;
        window.diaryEntries.push(newDiary);
        console.log(`ë©”ëª¨ë¦¬ ê¸¸ì´ í™•ì¸: ${oldLength} â†’ ${window.diaryEntries.length}`);
        console.log('ë©”ëª¨ë¦¬ì— ì €ì¥ëœ ë°ì´í„°:', window.diaryEntries);
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ ì‹œë„
        console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì‹œë„');
        const saveSuccess = saveDiary(newDiary);
        console.log('%cì €ì¥ ê²°ê³¼:', 'font-weight: bold;', saveSuccess ? 'ì„±ê³µ' : 'ì‹¤íŒ¨');
        
        // ì…ë ¥ í¼ ì´ˆê¸°í™”
        contentInput.value = '';
        
        // ëª¨ë‹¬ ë‹«ê¸°
        writeModal.classList.remove('modal-open');
        
        // ì„±ê³µ ë©”ì‹œì§€
        alert('ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì •: ' + emotion);
        
        // ì¼ê¸° ëª©ë¡ ì—…ë°ì´íŠ¸
        if (diaryList.classList.contains('hidden') === false) {
          console.log('ì¼ê¸° ëª©ë¡ ì—…ë°ì´íŠ¸');
          renderDiaryList();
        }
        
        console.log('%cì¼ê¸° ì €ì¥ ì™„ë£Œ', 'background: #ff0; color: #000; font-weight: bold; padding: 2px 5px;');
        return false; // ì¶”ê°€ ë°©ì–´ ì½”ë“œ
      } catch (err) {
        console.error('%cì¼ê¸° ì €ì¥ ì¤‘ ì˜¤ë¥˜', 'background: #f00; color: #fff; font-weight: bold; padding: 2px 5px;', err);
        alert('ì¼ê¸° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message);
        return false;
      }
    });
    
    // ì¼ê¸° ëª©ë¡ ë³´ê¸°
    viewDiaryBtn.addEventListener('click', () => {
      console.log('ì¼ê¸° ëª©ë¡ ë³´ê¸° ë²„íŠ¼ í´ë¦­');
      const wasHidden = diaryList.classList.contains('hidden');
      console.log(`ì´ì „ ìƒíƒœ: ${wasHidden ? 'ìˆ¨ê¹€' : 'í‘œì‹œ'}`);
      
      diaryList.classList.toggle('hidden');
      const isVisible = !diaryList.classList.contains('hidden');
      console.log(`í˜„ì¬ ìƒíƒœ: ${isVisible ? 'í‘œì‹œ' : 'ìˆ¨ê¹€'}`);
      
      if (isVisible) {
        console.log('ëª©ë¡ì´ í‘œì‹œë¨ - ë Œë”ë§ ì‹œì‘');
        renderDiaryList();
      }
    });
    
    // ì¼ê¸° ëª©ë¡ ë Œë”ë§
    function renderDiaryList() {
      console.log('%c=== ì¼ê¸° ëª©ë¡ ë Œë”ë§ ì‹œì‘ ===', 'background: #09f; color: #fff; font-weight: bold; padding: 2px 5px;');
      try {
        const diaries = getAllDiaries();
        console.log(`ë Œë”ë§í•  ì¼ê¸° ëª©ë¡: ${diaries ? diaries.length : 0}ê°œ í•­ëª©`);
        
        // í‘œì‹œí•  ì»¨í…Œì´ë„ˆ
        const container = document.getElementById('diaryItems');
        if (!container) {
          console.error('ì¼ê¸° ëª©ë¡ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        
        console.log('ì»¨í…Œì´ë„ˆë¥¼ ì°¾ìŒ, ë‚´ìš© ì´ˆê¸°í™”');
        container.innerHTML = '';
        
        if (!diaries || diaries.length === 0) {
          console.log('ì¼ê¸°ê°€ ì—†ìŒ - ë¹ˆ ë©”ì‹œì§€ í‘œì‹œ');
          container.innerHTML = '<p class="text-gray-500 text-center py-4">ì‘ì„±ëœ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
          console.log('%c=== ì¼ê¸° ëª©ë¡ ë Œë”ë§ ì™„ë£Œ (ë¹ˆ ëª©ë¡) ===', 'background: #09f; color: #fff; font-weight: bold; padding: 2px 5px;');
          return;
        }
        
        // ë Œë”ë§ ì •ë³´ í‘œì‹œ
        console.log('%cë Œë”ë§í•  ì²« ë²ˆì§¸ í•­ëª©:', 'font-weight: bold;');
        console.table(diaries[0]);
        
        try {
          // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
          console.log('ë‚ ì§œìˆœ ì •ë ¬ ì‹œì‘');
          diaries.sort((a, b) => new Date(b.date) - new Date(a.date));
          console.log('ì •ë ¬ ì™„ë£Œ');
          
          console.log(`${diaries.length}ê°œ í•­ëª© ë Œë”ë§ ì‹œì‘`);
          diaries.forEach((diary, index) => {
            if (!diary || !diary.id) {
              console.warn(`ìœ íš¨í•˜ì§€ ì•Šì€ ì¼ê¸° í•­ëª© (ì¸ë±ìŠ¤: ${index}):`, diary);
              return;
            }
            
            try {
              console.log(`í•­ëª© ${index+1}/${diaries.length} ë Œë”ë§: ID ${diary.id}`);
              const truncatedContent = diary.content && diary.content.length > 100 
                ? `${diary.content.slice(0, 100)}...` 
                : (diary.content || 'ë‚´ìš© ì—†ìŒ');
              
              const dateObj = new Date(diary.date);
              const formattedDate = isNaN(dateObj.getTime()) 
                ? 'ë‚ ì§œ ì—†ìŒ'
                : `${dateObj.getFullYear()}ë…„ ${dateObj.getMonth() + 1}ì›” ${dateObj.getDate()}ì¼`;
              
              const emotion = diary.emotion || 'neutral';
              const emotionIcon = emotionIcons[emotion] || emotionIcons.neutral;
              
              const diaryCard = document.createElement('div');
              diaryCard.className = `p-4 rounded-lg shadow-md cursor-pointer bg-emotion-${emotion} bg-opacity-10 hover:bg-opacity-20 transition-all border border-gray-200`;
              diaryCard.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                  <span class="text-sm text-gray-500">${formattedDate}</span>
                  <span class="text-2xl" role="img" aria-label="${emotion} ê°ì •">${emotionIcon}</span>
                </div>
                <p class="text-gray-700">${truncatedContent}</p>
                <div class="flex justify-end mt-2">
                  <button class="delete-btn text-red-500 text-sm" data-id="${diary.id}" aria-label="ì¼ê¸° ì‚­ì œ">ì‚­ì œ</button>
                </div>
              `;
              
              container.appendChild(diaryCard);
            } catch (itemErr) {
              console.error(`í•­ëª© ${index+1} ë Œë”ë§ ì˜¤ë¥˜:`, itemErr, diary);
            }
          });
          
          // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
          console.log('ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡');
          const deleteButtons = document.querySelectorAll('.delete-btn');
          console.log(`${deleteButtons.length}ê°œì˜ ì‚­ì œ ë²„íŠ¼ ë°œê²¬`);
          
          deleteButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
              e.stopPropagation();
              const id = e.target.dataset.id;
              console.log(`ì‚­ì œ ë²„íŠ¼ í´ë¦­: ID ${id}`);
              
              if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                console.log(`ID ${id} ì‚­ì œ í™•ì¸ë¨`);
                deleteDiary(id);
                console.log('ëª©ë¡ ë‹¤ì‹œ ë Œë”ë§');
                renderDiaryList();
              } else {
                console.log('ì‚­ì œ ì·¨ì†Œë¨');
              }
            });
          });
          
          console.log('%c=== ì¼ê¸° ëª©ë¡ ë Œë”ë§ ì™„ë£Œ ===', 'background: #09f; color: #fff; font-weight: bold; padding: 2px 5px;');
        } catch (sortErr) {
          console.error('ì¼ê¸° ëª©ë¡ ì •ë ¬ ì˜¤ë¥˜:', sortErr);
        }
      } catch (error) {
        console.error('ì¼ê¸° ëª©ë¡ ë Œë”ë§ ì˜¤ë¥˜:', error);
      }
    }
  </script>

  <script>
    // ì „ì²´ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì‹¤í–‰ë˜ëŠ” ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸
    document.addEventListener('DOMContentLoaded', function() {
      console.log('%cí˜ì´ì§€ ë¡œë“œ ì™„ë£Œ! DOM ì¤€ë¹„ë¨', 'background: #00f; color: #fff; font-size: 20px; padding: 10px;');
      
      // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ìƒíƒœ UI ì—…ë°ì´íŠ¸
      function updateStorageStatus() {
        const availableEl = document.getElementById('storageAvailable');
        const diaryCountEl = document.getElementById('storageDiaryCount');
        
        try {
          // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ í…ŒìŠ¤íŠ¸
          let isAvailable = false;
          try {
            const testKey = '__test__' + Date.now();
            localStorage.setItem(testKey, testKey);
            isAvailable = localStorage.getItem(testKey) === testKey;
            localStorage.removeItem(testKey);
          } catch (e) {
            isAvailable = false;
            console.error('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', e);
          }
          
          // ìƒíƒœ í‘œì‹œ
          if (availableEl) {
            availableEl.textContent = isAvailable ? 'ì‚¬ìš© ê°€ëŠ¥' : 'ì‚¬ìš© ë¶ˆê°€';
            availableEl.className = 'font-bold ' + (isAvailable ? 'text-green-600' : 'text-red-600');
          }
          
          // ì €ì¥ëœ ì¼ê¸° ìˆ˜ í™•ì¸
          if (diaryCountEl) {
            try {
              const diaryData = localStorage.getItem('mood-diary-entries');
              let count = 0;
              if (diaryData) {
                const entries = JSON.parse(diaryData);
                count = Array.isArray(entries) ? entries.length : 0;
              }
              diaryCountEl.textContent = count + 'ê°œ';
            } catch (e) {
              diaryCountEl.textContent = 'ì˜¤ë¥˜ (ì½ê¸° ì‹¤íŒ¨)';
              diaryCountEl.className = 'font-bold text-red-600';
            }
          }
          
          return isAvailable;
        } catch (e) {
          if (availableEl) {
            availableEl.textContent = 'ì˜¤ë¥˜ (' + e.message + ')';
            availableEl.className = 'font-bold text-red-600';
          }
          return false;
        }
      }
      
      // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
      function testLocalStorage() {
        try {
          alert('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
          
          // ê¸°ë³¸ í…ŒìŠ¤íŠ¸
          const testKey = 'test-diary-' + new Date().getTime();
          const testValue = 'í…ŒìŠ¤íŠ¸ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ - ' + new Date().toISOString();
          
          // ì½˜ì†”ê³¼ í™”ë©´ì— ëª¨ë‘ í‘œì‹œ
          console.log('ì €ì¥ ì‹œë„:', testKey, testValue);
          alert('ì €ì¥ ì‹œë„: ' + testKey + ' = ' + testValue);
          
          // ì €ì¥ ì‹œë„
          localStorage.setItem(testKey, testValue);
          
          // ì½ê¸° ì‹œë„
          const readValue = localStorage.getItem(testKey);
          console.log('ì½ê¸° ê²°ê³¼:', readValue);
          alert('ì½ê¸° ê²°ê³¼: ' + readValue);
          
          // ê²€ì¦
          const isSuccess = readValue === testValue;
          console.log('í…ŒìŠ¤íŠ¸ ì„±ê³µ ì—¬ë¶€:', isSuccess);
          alert('í…ŒìŠ¤íŠ¸ ' + (isSuccess ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'));
          
          // í…ŒìŠ¤íŠ¸ í‚¤ ì‚­ì œ
          localStorage.removeItem(testKey);
          alert('í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ' + (isSuccess ? 'ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì •ìƒ' : 'ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë¬¸ì œ ìˆìŒ'));
          
          // UI ì—…ë°ì´íŠ¸
          const resultEl = document.getElementById('storageTestResult');
          if (resultEl) {
            resultEl.textContent = isSuccess ? 'ì„±ê³µ' : 'ì‹¤íŒ¨';
            resultEl.className = 'font-bold ' + (isSuccess ? 'text-green-600' : 'text-red-600');
          }
          
          return isSuccess;
        } catch (e) {
          console.error('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜:', e);
          alert('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜: ' + e.message);
          
          // UI ì—…ë°ì´íŠ¸
          const resultEl = document.getElementById('storageTestResult');
          if (resultEl) {
            resultEl.textContent = 'ì˜¤ë¥˜ (' + e.message + ')';
            resultEl.className = 'font-bold text-red-600';
          }
          
          return false;
        }
      }
      
      // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™” í•¨ìˆ˜
      function clearLocalStorage() {
        try {
          if (confirm('ì •ë§ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì˜ ëª¨ë“  ì¼ê¸° ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            localStorage.removeItem('mood-diary-entries');
            window.diaryEntries = [];
            alert('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            updateStorageStatus();
          }
        } catch (e) {
          alert('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜: ' + e.message);
        }
      }
      
      // ì´ˆê¸° ìƒíƒœ ì—…ë°ì´íŠ¸
      updateStorageStatus();
      
      // í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
      const testBtn = document.getElementById('testLocalStorageBtn');
      if (testBtn) {
        testBtn.addEventListener('click', function(e) {
          console.log('í…ŒìŠ¤íŠ¸ ë²„íŠ¼ í´ë¦­ë¨');
          alert('í…ŒìŠ¤íŠ¸ ë²„íŠ¼ í´ë¦­ë¨');
          testLocalStorage();
        });
      }
      
      // ìƒíƒœ í™•ì¸ ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
      const checkBtn = document.getElementById('checkStorageBtn');
      if (checkBtn) {
        checkBtn.addEventListener('click', function() {
          updateStorageStatus();
          alert('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í–ˆìŠµë‹ˆë‹¤.');
        });
      }
      
      // ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
      const clearBtn = document.getElementById('clearStorageBtn');
      if (clearBtn) {
        clearBtn.addEventListener('click', clearLocalStorage);
      }
      
      // ê°•ì œ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
      const forceRefreshBtn = document.getElementById('forceRefreshBtn');
      if (forceRefreshBtn) {
        forceRefreshBtn.addEventListener('click', function() {
          alert('í˜ì´ì§€ë¥¼ ê°•ì œë¡œ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤. ìºì‹œê°€ ì™„ì „íˆ ì‚­ì œë©ë‹ˆë‹¤.');
          // ìºì‹œë¥¼ ë¬´ì‹œí•˜ê³  ê°•ì œ ìƒˆë¡œê³ ì¹¨
          window.location.reload(true);
        });
      }
      
      // ì™„ì „ ë¦¬ì…‹+í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
      const resetAndTestBtn = document.getElementById('resetAndTestBtn');
      if (resetAndTestBtn) {
        resetAndTestBtn.addEventListener('click', function() {
          try {
            // ëª¨ë“  ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°ì´í„° ì‚­ì œ
            localStorage.clear();
            // ë©”ëª¨ë¦¬ ë°ì´í„° ì´ˆê¸°í™”
            window.diaryEntries = [];
            alert('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì™€ ë©”ëª¨ë¦¬ê°€ ì™„ì „íˆ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.');
            
            // UI ì—…ë°ì´íŠ¸
            updateStorageStatus();
            
            // í…ŒìŠ¤íŠ¸ ì‹¤í–‰
            setTimeout(function() {
              testLocalStorage();
            }, 500);
          } catch (e) {
            alert('ë¦¬ì…‹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.message);
          }
        });
      }
      
      // í¼ ìš”ì†Œ ì§ì ‘ ë‹¤ì‹œ ì„ íƒ
      const diaryForm = document.getElementById('diaryForm');
      if (diaryForm) {
        console.log('í¼ ìš”ì†Œ ì°¾ìŒ:', diaryForm);
        
        // ë‘ ë²ˆì§¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆì™€ ë³„ê°œ)
        diaryForm.addEventListener('submit', function(e) {
          e.preventDefault();
          console.log('%cë‘ ë²ˆì§¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ: í¼ ì œì¶œë¨!', 'background: #f00; color: #fff; font-size: 20px; padding: 10px;');
          
          const dateInput = document.getElementById('diaryDate');
          const contentInput = document.getElementById('diaryContent');
          console.log('ì…ë ¥ê°’:', {
            ë‚ ì§œ: dateInput ? dateInput.value : 'ì—†ìŒ',
            ë‚´ìš©: contentInput ? contentInput.value : 'ì—†ìŒ'
          });
          
          // í¼ ì œì¶œ ì‹œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸ë„ ì¶”ê°€ ì‹¤í–‰
          alert('í¼ ì œì¶œ í›„ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸ ì‹¤í–‰');
          testLocalStorage();
        });
        
        // ì§ì ‘ ë²„íŠ¼ì— í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        const saveButton = document.getElementById('saveButton');
        if (saveButton) {
          console.log('ì €ì¥ ë²„íŠ¼ ì°¾ìŒ:', saveButton);
          saveButton.addEventListener('click', function(e) {
            console.log('%cì €ì¥ ë²„íŠ¼ í´ë¦­ë¨!', 'background: #0f0; color: #000; font-size: 20px; padding: 10px;');
            alert('ì €ì¥ ë²„íŠ¼ í´ë¦­ë¨!');
          });
        } else {
          console.error('ì €ì¥ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        }
      } else {
        console.error('í¼ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (DOMContentLoadedì—ì„œ)');
      }
    });
  </script>
</body>
</html> 